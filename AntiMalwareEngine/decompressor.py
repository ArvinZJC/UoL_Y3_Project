'''
@Description: TODO:
@Version: 1.0.1.20200221
@Author: Arvin Zhao
@Date: 2020-02-20 20:51:04
@Last Editors: Arvin Zhao
@LastEditTime: 2020-02-21 13:13:07
'''

import numpy as np


def decompress(a, num_dim):
    '''
    TODO: Decompress features to one-hot form.
    '''

    ans = []

    for x in a:
        oh = one_2d_to_3d(np.squeeze(x), num_dim)
        ans.append(oh)

    ans2 = np.vstack(ans)
    ans2 = np.expand_dims(ans2, 3)

    return ans2


def one_2d_to_3d(a, new_dim):
    '''
    TODO:
    '''

    b = np.zeros((a.shape[0], a.shape[1], new_dim))
    layer_idx = np.arange(a.shape[0]).reshape(a.shape[0], 1)
    component_idx = np.tile(np.arange(a.shape[1]), (a.shape[0], 1))
    b[layer_idx, component_idx, a] = 1
    b = b.transpose(1, 0, 2)

    return b


if __name__=='__main__':
    a = np.arange(12).reshape(2, 2, 3, 1)
    print(decompress(a, 12).shape) # logger?